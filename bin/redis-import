#!/usr/bin/env python
import argparse
import sys
import fileinput

from redline import commands


if __name__ == '__main__':
    parser = argparse.ArgumentParser(
            description='Tools for importing data into Redis.')

    parser.add_argument('-b', '--batch-size', default=10000,
            help='number of SADD operations to send per pipeline batch')

    #parser.add_argument('-u', '--unsorted', action="store_true",
    #        help='indicates that the input is unsorted')

    parser.add_argument('cmd',
            help='Redis command')
    parser.add_argument('key',
            help='name of the key for the command')
    parser.add_argument('infiles', nargs='*', 
            #type=argparse.FileType('r'), 
            #default=sys.stdin,
            metavar='FILE')
    options = parser.parse_args()

    cmd = options.cmd
    if cmd == 'set':
    	print sys.argv
        if len(sys.argv) > 3:
            input_set = fileinput.input(sys.argv[3:])
        else:
            input_set = sys.stdin
        commands.load_set(options.key, input_set, batch_size=options.batch_size)
    elif cmd == 'list':
        commands.load_list(options.key, sys.stdin, batch_size=options.batch_size)
